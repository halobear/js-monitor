!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("HaloMonitor",[],e):"object"==typeof exports?exports.HaloMonitor=e():t.HaloMonitor=e()}(this,(function(){return function(t){var e={};function r(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(o,n,function(e){return t[e]}.bind(null,n));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i,s={pid:"test",uid:n(r(1)).default,reportUrl:"",delay:1e3};!function(t){t[t.ERROR_RUNTIME=1]="ERROR_RUNTIME",t[t.ERROR_SCRIPT=2]="ERROR_SCRIPT",t[t.ERROR_STYLE=3]="ERROR_STYLE",t[t.ERROR_IMAGE=4]="ERROR_IMAGE",t[t.ERROR_AUDIO=5]="ERROR_AUDIO",t[t.ERROR_VIDEO=6]="ERROR_VIDEO",t[t.ERROR_CONSOLE=7]="ERROR_CONSOLE",t[t.ERROR_TRY_CATCH=8]="ERROR_TRY_CATCH"}(i||(i={}));var u,a={SCRIPT:i.ERROR_SCRIPT,LINK:i.ERROR_STYLE,IMG:i.ERROR_IMAGE,AUDIO:i.ERROR_AUDIO,VIDEO:i.ERROR_VIDEO},c=function(){function t(t){this.errors=[],this.timer=null,this.options=o(o({},s),t),this.init()}return t.prototype.init=function(){var t=this;window.addEventListener("error",(function(e){var r=e.target||{},o=r||{},n=(o.nodeName||"").toUpperCase();if(r!==window&&n&&n in a){var s=n,u=o;t.report({type:a[s],desc:u.baseURI+"@"+(u.src||u.href),stack:"no stack"})}else{var c=e.message,R=e.filename,f=e.lineno,l=e.colno,p=e.error;t.report({type:i.ERROR_RUNTIME,desc:c+" at "+R+":"+f+":"+l,stack:p&&p.stack?p.stack:"no stack"})}}),!0),window.addEventListener("unhandledrejection",(function(e){t.report({type:i.ERROR_RUNTIME,desc:"Unhandled Rejection reason: "+e.reason,stack:e.reason.stack||"no stack"})}),!0)},t.prototype.report=function(t){var e=this,r=this.formatError(t);if(!this.errors.some((function(t){return t.desc===r.desc}))){var o=this.options,n=o.delay,i=void 0===n?1e3:n,s=o.needReport;s&&!s(r)||(this.errors.push(r),this.timer&&clearTimeout(this.timer),this.errors.length>=5?this.toReport():this.timer=setTimeout((function(){e.toReport()}),i))}},t.prototype.toReport=function(){var t=this.options,e=t.pid,r=t.uid,o=t.reportUrl;if(!this.errors.length)return"";if(console.log("准备提交收集到的错误信息",this.errors),!o)return console.error("没有配置reportUrl");var n=["pid="+e,"uid="+r];this.errors.forEach((function(t,e){Object.keys(t).forEach((function(r){var o=t[r]||"";n.push(r+"["+e+"]="+o)}))}));var i=o+"?"+n.join("&");(new Image).src=i,this.errors=[]},t.prototype.formatError=function(t){return o(o({},t),{stack:t.stack.slice(0,150),from:window.location.href})},t}();e.default=function(t){return t.reportUrl?u||(u=new c(t)):(console.error("没有配置reportUrl"),null)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,n="halo_monitor_uid";e.default=((o=localStorage.getItem(n))||(o=Number(Math.random().toString().substr(3,11)+Date.now()).toString(36),localStorage.setItem(n,o)),o)}]).default}));